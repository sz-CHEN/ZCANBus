cmake_minimum_required(VERSION 3.0)
project(ZCANBus)

set(CMAKE_CXX_STANDARD 11)

# set(USE_PEAK true)

# set(USE_KVASER true)

if(CMAKE_SIZEOF_VOID_P EQUAL 8)
  set(_COMPILER_ARCHITECTURE x64)
endif(CMAKE_SIZEOF_VOID_P EQUAL 8)

if(MSVC)
  add_definitions(-D_CRT_SECURE_NO_WARNINGS)
endif()
set(CAN_FILE CANHandler.cpp)
set(ZCANBus_LINK_DIR_TMP)
set(ZCANBus_LINK_LIB_TMP)
set(ZCANBus_INC_DIR_TMP)

if(CMAKE_HOST_WIN32)
  if(_COMPILER_ARCHITECTURE STREQUAL x64)
    link_directories(lib/x64)
    list(APPEND ZCANBus_LINK_DIR_TMP ${CMAKE_CURRENT_SOURCE_DIR}/lib/x64)
  else()
    link_directories(lib/MS)
    list(APPEND ZCANBus_LINK_DIR_TMP ${CMAKE_CURRENT_SOURCE_DIR}/lib/MS)
  endif(_COMPILER_ARCHITECTURE STREQUAL x64)
endif(CMAKE_HOST_WIN32)

if(USE_PEAK)
  list(APPEND CAN_FILE CANPeak.cpp)
  if(CMAKE_HOST_WIN32)
    include_directories(include/peak)
    list(APPEND ZCANBus_INC_DIR_TMP ${CMAKE_CURRENT_SOURCE_DIR}/include/peak)
    link_libraries(PCANBasic)
    list(APPEND ZCANBus_LINK_LIB_TMP PCANBasic)
  elseif(CMAKE_HOST_APPLE)
    # link_libraries(pcanbasic)

    # list(APPEND ZCANBus_LINK_LIB_TMP pcanbasic)
    link_libraries(PCBUSB)
    list(APPEND ZCANBus_LINK_LIB_TMP PCBUSB)
  elseif(CMAKE_HOST_UNIX)
    link_libraries(pcanbasic)
    list(APPEND ZCANBus_LINK_LIB_TMP pcanbasic)
  else()
    message(FATAL_ERROR "Unsupported OS " ${CMAKE_HOST_SYSTEM})
  endif(CMAKE_HOST_WIN32)
  add_definitions(-DUSE_PEAK)
endif(USE_PEAK)

if(USE_KVASER)
  list(APPEND CAN_FILE CANKvaser.cpp)
  if(CMAKE_HOST_WIN32)
    include_directories(include/kvaser)
    list(APPEND ZCANBus_INC_DIR_TMP ${CMAKE_CURRENT_SOURCE_DIR}/include/kvaser)
    link_libraries(canlib32)
    list(APPEND ZCANBus_LINK_LIB_TMP canlib32)
  elseif(CMAKE_HOST_UNIX)
    link_libraries(canlib)
    list(APPEND ZCANBus_LINK_LIB_TMP canlib)
  else()
    message(FATAL_ERROR "Unsupported OS " ${CMAKE_HOST_SYSTEM})
  endif(CMAKE_HOST_WIN32)
  add_definitions(-DUSE_KVASER)
endif(USE_KVASER)

if(CMAKE_HOST_UNIX)
  link_libraries(pthread)
  list(APPEND ZCANBus_LINK_LIB_TMP pthread)
endif(CMAKE_HOST_UNIX)
set(CMAKE_DEBUG_POSTFIX _d)
set(ZCANBus_LINK_DIR ${ZCANBus_LINK_DIR_TMP} CACHE STRING "ZCANBus_LINK_DIR")
set(ZCANBus_LINK_LIB ${ZCANBus_LINK_LIB_TMP} CACHE STRING "ZCANBus_LINK_LIB")
set(ZCANBus_INC_DIR ${ZCANBus_INC_DIR_TMP} CACHE STRING "ZCANBus_INC_DIR")
add_library(${PROJECT_NAME} ${CAN_FILE})
